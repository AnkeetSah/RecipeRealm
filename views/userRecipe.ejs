<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recipe Page</title>
    <style>
      /* Reset some default browser styles */
      * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
      }

      body,
      h1,
      p,
      ul,
      
      a {
        margin: 0;
        padding: 0;
        list-style: none;
        text-decoration: none;
        box-sizing: border-box;
      }

      /* General body styling */
      body {
        font-family: Arial, sans-serif;
        color: #fff;
        background-color: #121212;
      }

      /* Header styling */
      header {
        background-color: #1b1b1b;
        padding: 20px;
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
      }

      nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 24px;
        font-weight: bold;
        color: #00ff00;
      }

      .nav-links {
        display: flex;
        gap: 20px;
        margin-right: 20px; /* Move links a bit to the left */
      }

      .nav-links a {
        color: #fff;
        transition: color 0.3s;
      }

      .nav-links a:hover {
        color: #00ff00;
      }

      .menu-icon {
        display: none;
        font-size: 24px;
        cursor: pointer;
        color: #fff;
      }

      .menu-icon:hover {
        color: #00ff00;
      }

      /* Container styling */
      .container {
        width: 85%;
        margin: 100px auto 0;
        padding: 20px;
        background-color: #1b1b1b;
        color: #fff;
      }

      .head {
        display: flex;
        justify-content: space-between;
        background-color: #333;
        border: 1px solid #444;
        border-radius: 10px;
        padding: 20px;
        flex-wrap: wrap;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
      }

      .headchild {
        width: 48%;
      }

      img {
        width: 100%;
        height: 400px;
        border-radius: 10px;
      }

      .about-section {
        margin-top: 0;
        padding: 20px;
      }

      .about-section h2 {
        font-size: 28px;
        color: #00ff00;
        margin-bottom: 10px;
      }

      .likes {
        display: flex;
        justify-content: space-evenly;
        margin-top: 20px;
      }

      .likes a,
      button {
        cursor: pointer;
        padding: 10px 15px;
        background: #444;
        border-radius: 5px;
        transition: background 0.3s;
        color: #fff;
        text-decoration: none;
      }

      .likes a:hover {
        background: #555;
      }

      h1 {
        font-size: 24px;
        font-family: cursive;
        text-align: center;
        margin-left: 20px;
        margin-top: 30px;
        margin-bottom: 20px;
      }

      q {
        font-style: normal;
      }

      @media (max-width: 450px) {
        .headchild {
          width: 100%;
        }
      }

      .design {
        height: 220px;
        display: block;
        width: 120px;
      }

      .ingrediants {
        width: 40%;
        background-color: #333;
        min-height: 600px;
        max-height: auto;
        border-radius: 10px;
        padding: 30px;
        margin-right: 40px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
      }

      .instruction {
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        width: 55%;
        background-color: #333;
        min-height: 600px;
        max-height: auto;
        border-radius: 10px;
        padding: 30px;
      }

      .Recipe {
        margin-top: 20px;
        height: auto;
        display: flex;
      }

      .items {
        margin-bottom: 25px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .footer {
        text-align: center;
        padding: 20px;
        background-color: #00ff00;
        border-radius: 10px;
        margin-top: 20px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
      }

      .footer p {
        font-size: 14px;
        color: #000;
      }

      @media (max-width: 768px) {
        .nav-links {
          display: none;
        }

        .menu-icon {
          display: block;
        }

        .nav-links.mobile {
          display: flex;
          flex-direction: column;
          gap: 10px;
          background: #1b1b1b;
          position: absolute;
          top: 60px;
          right: 20px;
          padding: 20px;
          border-radius: 5px;
        }

        .nav-links.mobile a {
          color: #00ff00;
        }
      }

      @media (min-width: 769px) {
        .menu-icon {
          display: none;
        }
      }
      .comment_div{
         width: 450px;
         background-color: red;
         height: 590px;
         position: absolute;
         left:-550px;
         border-radius: 10px ;
         padding: 5px -16px;
         padding-bottom: 20px;
         background: #333;
         overflow: auto;
         color: black;
         border: solid 20px black;
        
      }
      .show-comment {
        left: 0px; 
        top: 70px;
      }
      .comment_div h1{
        text-align: left;
        font-family: sans-serif;
        color: #00ff00;
        
      }
      .comment_div textarea{
       
        width: 90%;
        color: black;
        background: white;
      
        margin-left: 20px;
        border-radius: 5px;
        padding: 15px 15px 5px;
        outline: none;
       
       
        /* Set the width of the textarea */
      height: 150px; /* Set the height of the textarea */
      overflow: auto;
      resize: none; 
      }

      .comment_div button{
        background:         #00ff00;

        color: black;
         margin-left: 310px;
        margin-top: 10px;

      }

      .commnetsdiv{
       padding: 0px 20px;
      }
      .comment_div h3{
        color: white;
       font-style: italic;
        margin-bottom: 8px;

        margin-top: 20px;
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
      }

      .comment_div p{
        color:#00ff00;
        font-size: smaller;
        font-weight: bolder;
      }
    </style>
  </head>
  <body>
    <header>
      <nav>
        <div class="logo">RecipeApp</div>
        <div class="menu-icon" id="menuIcon">&#9776;</div>
        <ul class="nav-links" id="navLinks">
          <li><a href="/home">Home</a></li>
                <li><a href="/home/recipe">Recipes</a></li>
                <li><a href="/home/account">Account</a></li>
                <li><a href="/home/leaderBoard">Leader-Board</a></li>
                <li><a href="/home/aboutus">About</a></li>
        </ul>
      </nav>
    </header>

    <div class="comment_div">
<h1>Comments(4)</h1>
<textarea placeholder="What are your thoughts?" id="comment_wrote"></textarea>
 <button class="addCommment">Add</button>
 <br>
 <br>

 <div class="commnetsdiv">
  <% postData.comments.forEach(e=>{ %>
    
 <h3 class="username"><%= e.commented_user.name %></h3>
 <p class="thoughts"><%= e.Comment %></p>
 <% }) %>
 </div>

  
    </div>

   

    <div class="container">
      <div class="head">
        <div class="headchild">
          <div class="img">
            <img
              src="/images/uploads/<%= postData.filename %>"
              alt="Recipe Image"
            />
          </div>
        </div>
        <div class="headchild about-section">
          <h2><%= postData.dishName %></h2>

          <div class="likes">
            <button onclick="likeUpdate(this)">
              <%= postData.total_likes.length %> Likes
            </button>     
            <button id="comment" href="#">Comments</button>
            <button href="#">Save</button>
          </div>
          <h4
            style="
              text-align: center;
              margin-top: 30px;
              font-style: italic;
              margin-bottom: -40px;
            "
          >
            <span style="color: #00ff00">Created by: </span><%= userData[0].name
            %>
            <br>
          </h4>
          <div style="display: flex; margin-top: 40px; align-items: center">
            <img
              class="design"
              src="https://cdn-icons-png.flaticon.com/512/12331/12331588.png"
              alt=""
            />
            <h1>
              <q
                >Cooking is a way of showing love and <br />appreciation to
                those you care about</q
              >
            </h1>
          </div>
        </div>
      </div>

      <div class="Recipe">
        <div class="ingrediants">
          <h1 style="text-align: left">Ingredients</h1>

          <% ingredients.forEach(ingredient => { %>
          <div class="items">
            <p style="display: flex; align-items: center">
              <img
                style="width: 25px; height: 25px; margin-right: 10px"
                src="https://cdn-icons-png.flaticon.com/512/6785/6785304.png"
                alt=""
              />
              <%= ingredient %>
            </p>
          </div>
          <% }); %>
        </div>
        <div class="instruction">
          <h1 style="text-align: left">Instructions</h1>
          <ol style="list-style-type: decimal; margin-left: 20px">
            <% instruction.forEach(instruction => { %>
            <li style="margin-bottom: 20px"><%= instruction %></li>
            <% }) %>
          </ol>
        </div>
      </div>

      <!-- Embed YouTube Video -->
      <div class="video-section" style="margin-top: 20px; text-align: center">
        <% if (postData.dishYouTubeLink) { 
            let youtubeLink;
            if (postData.dishYouTubeLink.includes('youtu.be')) {
                youtubeLink = postData.dishYouTubeLink.split('.be/')[1]; // For short URLs
            } else if (postData.dishYouTubeLink.includes('v=')) {
                youtubeLink = postData.dishYouTubeLink.split('v=')[1]; // For standard URLs
            }
    
            // Validate if youtubeLink has a value and seems correct
            if (youtubeLink) {
        %>
            <iframe 
                width="560" 
                height="315" 
                src="https://www.youtube.com/embed/<%= youtubeLink %>" 
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen>
            </iframe>
        <% 
            } else { 
        %>
            <p>Invalid YouTube link.</p>
        <% 
            } 
        } else { 
        %>
            <p>No video available for this recipe.</p>
        <% } %>
    </div>
    
    
    </div>

    <div class="footer">
      <p>&copy; 2024 Recipe Page. All Rights Reserved.</p>
    </div>

    <script>
      const postId='<%= postId %>';
      
      const menuIcon = document.getElementById("menuIcon");
      const navLinks = document.getElementById("navLinks");

      menuIcon.addEventListener("click", () => {
        navLinks.classList.toggle("mobile");
      });

      navLinks.addEventListener("click", (e) => {
        if (e.target.tagName === "A") {
          navLinks.classList.remove("mobile");
        }
      });

      const likeUpdate = (elem) => {
        const postid = "<%= postData._id %>";

        fetch("/likeUpdate", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ postid }),
        })
          .then((response) => {
            if (response.ok) {
              return response.json();
            }
          })
          .then((data) => {
            elem.innerText = data.message + " Likes";
          });
      };



      const comment=document.getElementById('comment');
       comment.addEventListener('click',()=>{
        


       });
 
       const commnetsdiv=document.querySelector(".commnetsdiv");
       const comment_div=document.querySelector('.comment_div');
       const commentButton=document.querySelector('#comment')
       const comment_wrote=document.querySelector('#comment_wrote');
       const addCommment=document.querySelector('.addCommment');
       addCommment.addEventListener('click', async ()=>{
        
       

        const response= await fetch('http://localhost:3000/comments',{
          method:"post",
          headers:{
             "content-type":"application/json"
          },
          body:JSON.stringify({comment:comment_wrote.value,postId:postId})
        });

        if (response.ok) {
      

          const data=await response.json();
          
           data.comments.forEach(e=>{
            console.log(e.Comment);
           });
             let comment_part=`
             <h3 class="username">Ankeet Kumar Sah</h3>
            <p class="thoughts">${comment_wrote.value}</p>
            `;
            commnetsdiv.innerHTML+=comment_part;
           
            comment_wrote.value="";

         };

       
      
      


       });


       

commentButton.addEventListener("click", function () {
  console.log('object');
  comment_div.classList.toggle("show-comment");
});


   


      
    </script>
  </body>
</html>
